<!--
Store Angel – Vanilla JS Stock & POS
Author: ChatGPT for Damie
Tech: HTML + CSS + Vanilla JS (no React). Font Awesome icons. Chart.js for charts.
Files in this project (scroll to each section):
  1) /index.html         – App shell with <details> layout flows (no page reloads)
  2) /styles.css         – App styling + animations + responsive + POS keypad
  3) /printer.css        – Print styles for receipts
  4) /app.js             – App boot, routing (details/opacity flows), auth, POS logic
  5) /storage.js         – LocalStorage DB, CloudSync adapter, offline queue
  6) /charts.js          – Dashboard analytics + pie chart (best performing items)
  7) /server.js (optional) – Node/Express + Socket.IO stub for multi‑PC live sync
  8) /README.md          – Quick setup & usage notes
You can download each section as separate files with the same names.
-->

<!-- =============================
= 1) /index.html
============================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Store Angel – Stock & POS</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="printer.css" media="print" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="storage.js"></script>
  <script defer src="charts.js"></script>
  <script defer src="app.js"></script>
  <!-- Font Awesome Free -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-uFfYq7Y6F4p3..." crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <i class="fa-solid fa-store"></i>
      <span id="storeName">Store Angel</span>
    </div>
    <div class="userbar">
      <span id="presenceDot" class="presence offline" title="Offline"></span>
      <span id="userRole">Guest</span> · <span id="userName">—</span>
      <button id="btnLogin" class="btn sm"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
      <button id="btnLogout" class="btn sm ghost hidden"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </div>
  </header>

  <main class="shell">
    <!-- Flowing sections using <details> for smooth UX without page loads -->

    <details id="secPOS" class="card flow" open>
      <summary><i class="fa-solid fa-cash-register"></i> POS – Sales Point</summary>
      <div class="flow-body">
        <div class="pos">
          <section class="pos-left">
            <div class="search-row">
              <input id="scanInput" placeholder="Scan barcode or type to search…" autocomplete="off" />
              <button id="btnAddQuick" class="btn"><i class="fa-solid fa-plus"></i> Add</button>
            </div>
            <div class="catalog" id="catalogList"></div>
          </section>
          <section class="pos-right">
            <div class="ticket" id="ticketArea">
              <div class="ticket-head">
                <div>Customer Screen</div>
                <div class="muted" id="ticketTime"></div>
              </div>
              <div class="lines" id="ticketLines"></div>
              <div class="totals">
                <div>Subtotal <span id="subTotal">0.00</span></div>
                <div>Discount <input id="discount" type="number" min="0" value="0"/></div>
                <div class="grand">Total <span id="grandTotal">0.00</span></div>
              </div>
            </div>
            <div class="keypad">
              <div class="pay-modes">
                <button class="btn pay" data-mode="cash"><i class="fa-solid fa-money-bill-wave"></i> Cash</button>
                <button class="btn pay" data-mode="pos"><i class="fa-solid fa-credit-card"></i> POS</button>
                <button class="btn pay" data-mode="transfer"><i class="fa-solid fa-building-columns"></i> Transfer</button>
                <button class="btn pay" data-mode="mixed"><i class="fa-solid fa-layer-group"></i> Mixed</button>
              </div>
              <div class="numpad" id="numpad">
                <button data-key="7">7</button><button data-key="8">8</button><button data-key="9">9</button>
                <button data-key="4">4</button><button data-key="5">5</button><button data-key="6">6</button>
                <button data-key="1">1</button><button data-key="2">2</button><button data-key="3">3</button>
                <button data-key="0">0</button><button data-key="." >.</button><button data-key="⌫" aria-label="Backspace">⌫</button>
              </div>
              <div class="actions">
                <button id="btnHold" class="btn ghost"><i class="fa-solid fa-hand"></i> Hold</button>
                <button id="btnClear" class="btn ghost"><i class="fa-solid fa-trash"></i> Clear</button>
                <button id="btnCheckout" class="btn primary"><i class="fa-solid fa-print"></i> Checkout</button>
              </div>
            </div>
          </section>
        </div>
      </div>
    </details>

    <details id="secInventory" class="card flow">
      <summary><i class="fa-solid fa-boxes-stacked"></i> Inventory</summary>
      <div class="flow-body">
        <form id="itemForm" class="grid2">
          <input name="name" required placeholder="Item name" />
          <input name="sku" placeholder="SKU / Barcode" />
          <input name="unit" placeholder="Unit (pcs, pack, roll…)" />
          <input name="weight" type="text" placeholder="Weight (e.g., 500g, 1kg)" />
          <input name="color" placeholder="Color (e.g., red)" />
          <input name="price" type="number" min="0" step="0.01" placeholder="Price" />
          <input name="quantity" type="number" min="0" step="1" placeholder="Qty" />
          <button class="btn" type="submit"><i class="fa-solid fa-plus"></i> Add / Update</button>
        </form>
        <div class="table-wrap">
          <table class="table" id="itemsTable">
            <thead>
              <tr><th>SKU</th><th>Name</th><th>Unit</th><th>Weight</th><th>Color</th><th>Price</th><th>Qty</th><th></th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="row">
          <input type="file" id="csvFile" accept=".csv" />
          <button id="btnImportCSV" class="btn ghost"><i class="fa-solid fa-file-import"></i> Import CSV</button>
          <button id="btnExportCSV" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export CSV</button>
        </div>
      </div>
    </details>

    <details id="secCashiers" class="card flow">
      <summary><i class="fa-solid fa-user-group"></i> Cashiers</summary>
      <div class="flow-body">
        <form id="cashierForm" class="grid2">
          <input name="name" required placeholder="Cashier name" />
          <input name="username" required placeholder="Username" />
          <input name="password" required placeholder="Password" />
          <button class="btn" type="submit"><i class="fa-solid fa-user-plus"></i> Add / Update</button>
        </form>
        <div class="table-wrap">
          <table class="table" id="cashiersTable">
            <thead>
              <tr><th>Name</th><th>Username</th><th>Status</th><th>Hours Today</th><th></th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </details>

    <details id="secDashboard" class="card flow">
      <summary><i class="fa-solid fa-chart-pie"></i> Dashboard (Admin)</summary>
      <div class="flow-body grid2">
        <div class="card inset">
          <div class="row between">
            <div>
              <div class="muted">Today Sales</div>
              <div class="stat" id="statSalesToday">₦0</div>
            </div>
            <div>
              <div class="muted">Items in Stock</div>
              <div class="stat" id="statStockCount">0</div>
            </div>
            <div>
              <div class="muted">Active Cashiers</div>
              <div class="stat" id="statActiveCashiers">0</div>
            </div>
          </div>
        </div>
        <div class="card inset">
          <canvas id="bestItemsChart" height="200"></canvas>
        </div>
        <div class="card inset">
          <label>Custom Period</label>
          <input type="date" id="fromDate" />
          <input type="date" id="toDate" />
          <button id="btnRange" class="btn sm">Apply</button>
          <div class="table-wrap">
            <table class="table" id="salesTable">
              <thead><tr><th>Date</th><th>Cashier</th><th>Items</th><th>Total</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </details>

    <details id="secSettings" class="card flow">
      <summary><i class="fa-solid fa-gear"></i> Settings</summary>
      <div class="flow-body grid2">
        <div class="card inset">
          <label>Store Name</label>
          <input id="settingStoreName" placeholder="Store Angel" />
          <label>Receipt Header</label>
          <textarea id="settingReceiptHeader" rows="3" placeholder="Store Angel\n123 Market Road, Lagos\n0700-ANGEL-STORE"></textarea>
          <label>Receipt Footer</label>
          <textarea id="settingReceiptFooter" rows="3" placeholder="Thanks for shopping!"></textarea>
          <button id="btnSaveSettings" class="btn"><i class="fa-solid fa-floppy-disk"></i> Save Settings</button>
        </div>
      </div>
    </details>

    <!-- Hidden print template -->
    <section id="printArea" class="print-area">
      <div class="receipt" id="receipt"></div>
    </section>
  </main>

  <!-- Auth Modal -->
  <dialog id="authModal">
    <form method="dialog" class="auth">
      <h3><i class="fa-solid fa-user-shield"></i> Login</h3>
      <select id="loginRole">
        <option value="cashier">Cashier</option>
        <option value="admin">Admin</option>
      </select>
      <input id="loginUser" placeholder="Username" required />
      <input id="loginPass" type="password" placeholder="Password" required />
      <menu>
        <button value="cancel" class="btn ghost">Cancel</button>
        <button id="btnDoLogin" value="default" class="btn primary">Login</button>
      </menu>
    </form>
  </dialog>

  <!-- Barcode capture (keyboard wedge scanners type here) -->
  <input id="barcodeHidden" class="hidden" autocomplete="off" />
</body>
</html>


<!-- =============================
= 2) /styles.css
============================== -->
<style id="styles.css">
:root{--bg:#0a0b10;--card:#141726;--inset:#0f1220;--text:#e8ebf5;--muted:#9aa3b2;--brand:#e11d48;--ok:#10b981;--warn:#f59e0b;--err:#ef4444}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
.hidden{display:none!important}
.topbar{position:sticky;top:0;z-index:50;background:rgba(10,11,16,.9);backdrop-filter:blur(8px);display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #1f2436}
.brand{display:flex;gap:10px;align-items:center;font-weight:700}
.userbar{display:flex;gap:10px;align-items:center}
.presence{width:10px;height:10px;border-radius:50%;display:inline-block}.presence.offline{background:#6b7280}.presence.online{background:var(--ok)}
.shell{padding:16px;display:grid;gap:14px}
.card{background:var(--card);border:1px solid #20263a;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
.card.inset{background:var(--inset)}
.flow{transition:opacity .35s ease}
.flow[open]>.flow-body{animation:fadeIn .35s ease both}
summary{list-style:none;cursor:pointer;padding:14px 16px;font-weight:700;display:flex;gap:10px;align-items:center}
summary::-webkit-details-marker{display:none}
.flow-body{padding:16px;border-top:1px solid #20263a}
.row{display:flex;gap:10px;align-items:center}.row.between{justify-content:space-between}
.grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
.table-wrap{overflow:auto;max-height:50vh;border:1px solid #232a40;border-radius:12px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px 10px;border-bottom:1px solid #232a40}
.table tbody tr:hover{background:#171b2c}
.muted{color:var(--muted);font-size:.9rem}
.stat{font-size:1.4rem;font-weight:700}
.btn{background:#1f253a;border:1px solid #2a3150;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;transition:transform .06s ease,background .2s}
.btn:hover{transform:translateY(-1px)}
.btn.primary{background:var(--brand);border-color:#b21036}
.btn.ghost{background:transparent;border-color:#2a3150}
.btn.sm{padding:6px 8px;border-radius:10px}

/* POS layout */
.pos{display:grid;grid-template-columns:1.4fr .9fr;gap:14px}
.pos-left,.pos-right{display:flex;flex-direction:column;gap:12px}
.search-row{display:flex;gap:8px}
.search-row input{flex:1;padding:12px 10px;border-radius:12px;border:1px solid #29314e;background:#0f1220;color:var(--text)}
.catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;max-height:60vh;overflow:auto}
.catalog .item{background:#171b2c;border:1px solid #232a40;border-radius:16px;padding:10px;display:flex;flex-direction:column;gap:6px;cursor:pointer}
.catalog .item:hover{outline:2px solid #2f3a60}
.catalog .name{font-weight:700}
.catalog .price{color:#a5ffd6}
.ticket{background:#0f1220;border:1px dashed #2d3453;border-radius:16px;padding:12px;min-height:220px;display:flex;flex-direction:column}
.ticket-head{display:flex;justify-content:space-between;margin-bottom:8px}
.lines{flex:1;overflow:auto;border-top:1px dashed #2d3453;border-bottom:1px dashed #2d3453}
.line{display:grid;grid-template-columns:2fr repeat(3,1fr) auto;gap:6px;align-items:center;padding:6px 0}
.line .qty{display:flex;gap:6px;align-items:center}
.line input{width:64px;padding:6px;border-radius:10px;border:1px solid #29314e;background:#0b0e19;color:var(--text)}
.totals{display:grid;gap:6px;margin-top:8px}
.totals .grand{font-size:1.3rem;font-weight:700}
.keypad{display:flex;flex-direction:column;gap:10px}
.numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.numpad button{padding:14px;border-radius:14px;border:1px solid #2a3150;background:#161b2c;font-size:1.3rem}
.pay-modes{display:flex;gap:8px;flex-wrap:wrap}
.pay-modes .btn.pay{flex:1}
.actions{display:flex;gap:8px}

/* Print area */
.print-area{position:fixed;inset:0;padding:20px;pointer-events:none;opacity:0}
.receipt{max-width:360px;margin:0 auto;background:#fff;color:#000;padding:10px;border:1px solid #000;font-family:monospace}

/* Responsive */
@media (max-width: 900px){
  .pos{grid-template-columns:1fr}
  .grid2{grid-template-columns:1fr}
}

@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
</style>


<!-- =============================
= 3) /printer.css
============================== -->
<style id="printer.css">
@media print{
  body{background:#fff}
  .topbar,.shell>details:not(#secPOS),.keypad,.search-row,.catalog{display:none!important}
  #printArea{opacity:1}
  .receipt{border:none}
}
</style>


<!-- =============================
= 4) /app.js
============================== -->
<script id="app.js">
/* Store Angel – App Boot & UI Logic */
(() => {
  const $ = (q,root=document)=>root.querySelector(q);
  const $$ = (q,root=document)=>Array.from(root.querySelectorAll(q));

  const authModal = $('#authModal');
  const btnLogin = $('#btnLogin');
  const btnLogout = $('#btnLogout');
  const userRole = $('#userRole');
  const userName = $('#userName');
  const presenceDot = $('#presenceDot');

  const scanInput = $('#scanInput');
  const barcodeHidden = $('#barcodeHidden');
  const catalogList = $('#catalogList');
  const itemsTable = $('#itemsTable tbody');
  const itemForm = $('#itemForm');
  const cashierForm = $('#cashierForm');
  const cashiersTable = $('#cashiersTable tbody');

  const subTotalEl = $('#subTotal');
  const grandTotalEl = $('#grandTotal');
  const discountEl = $('#discount');
  const ticketLines = $('#ticketLines');
  const ticketTime = $('#ticketTime');

  const statSalesToday = $('#statSalesToday');
  const statStockCount = $('#statStockCount');
  const statActiveCashiers = $('#statActiveCashiers');

  const settingStoreName = $('#settingStoreName');
  const settingReceiptHeader = $('#settingReceiptHeader');
  const settingReceiptFooter = $('#settingReceiptFooter');
  const storeNameEl = $('#storeName');

  const printArea = $('#printArea');
  const receipt = $('#receipt');

  const state = {
    cart: [],
    paymentMode: 'cash',
    user: null,
  };

  // Presence & online status
  function setOnline(v){
    presenceDot.classList.toggle('online', v);
    presenceDot.classList.toggle('offline', !v);
    presenceDot.title = v ? 'Online' : 'Offline';
  }
  setOnline(navigator.onLine);
  window.addEventListener('online', ()=>setOnline(true));
  window.addEventListener('offline', ()=>setOnline(false));

  // ---------- Auth ----------
  function openLogin(){ authModal.showModal(); }
  function closeLogin(){ authModal.close(); }

  btnLogin.addEventListener('click', openLogin);
  btnLogout.addEventListener('click', () => {
    StorageAPI.logout();
    state.user = null; userRole.textContent='Guest'; userName.textContent='—';
    btnLogout.classList.add('hidden'); btnLogin.classList.remove('hidden');
    refreshGuards();
  });
  $('#btnDoLogin').addEventListener('click', (e)=>{
    e.preventDefault();
    const role = $('#loginRole').value;
    const u = $('#loginUser').value.trim();
    const p = $('#loginPass').value;
    const ok = StorageAPI.login(role, u, p);
    if(!ok){ alert('Invalid credentials'); return; }
    state.user = StorageAPI.currentUser();
    userRole.textContent = state.user.role.toUpperCase();
    userName.textContent = state.user.name;
    btnLogout.classList.remove('hidden'); btnLogin.classList.add('hidden');
    closeLogin();
    refreshGuards();
  });

  function refreshGuards(){
    const role = state.user?.role || 'guest';
    // Role-based route guards (frontend)
    $('#secCashiers').open = role==='admin';
    $('#secInventory').open = true; // both can view, but editing checks per action
    $('#secDashboard').open = role==='admin';
    // Disable editing for cashier in inventory form/table
    itemForm.querySelector('button[type="submit"]').disabled = (role!=='admin');
    $$('#itemsTable .btn.delete').forEach(b=> b.disabled=(role!=='admin'));
  }

  // ---------- Inventory ----------
  function renderCatalog(items){
    catalogList.innerHTML = '';
    items.forEach(it => {
      const card = document.createElement('button');
      card.className = 'item';
      card.innerHTML = `<div class="name">${it.name}</div>
        <div class="muted">${it.unit||''} ${it.weight?('· '+it.weight):''} ${it.color?('· '+it.color):''}</div>
        <div class="price">₦${(+it.price).toLocaleString()}</div>
        <div class="muted">Stock: ${it.quantity}</div>`;
      card.addEventListener('click', ()=> addToCart(it.sku||it.id, 1));
      catalogList.appendChild(card);
    });
  }

  function renderItemsTable(items){
    itemsTable.innerHTML = '';
    for(const it of items){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${it.sku||''}</td><td>${it.name}</td><td>${it.unit||''}</td><td>${it.weight||''}</td><td>${it.color||''}</td><td>₦${(+it.price).toLocaleString()}</td><td>${it.quantity}</td><td class="right">
        <button class="btn sm ghost edit"><i class="fa-solid fa-pen"></i></button>
        <button class="btn sm ghost delete"><i class="fa-solid fa-trash"></i></button>
      </td>`;
      tr.querySelector('.edit').addEventListener('click', ()=>{
        if((state.user?.role||'')!=='admin'){ return alert('Only admin can edit'); }
        for(const [k,v] of Object.entries(it)){
          if(itemForm[k]) itemForm[k].value = v;
        }
      });
      tr.querySelector('.delete').addEventListener('click', ()=>{
        if((state.user?.role||'')!=='admin'){ return alert('Only admin can delete'); }
        if(confirm('Delete item?')){
          StorageAPI.deleteItem(it.id);
          loadData();
        }
      });
      itemsTable.appendChild(tr);
    }
  }

  itemForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    if((state.user?.role||'')!=='admin'){ return alert('Only admin can add/update'); }
    const f = new FormData(itemForm);
    const data = Object.fromEntries(f.entries());
    data.price = +data.price||0; data.quantity = +data.quantity||0;
    StorageAPI.upsertItem(data);
    itemForm.reset();
    loadData();
  });

  $('#btnImportCSV').addEventListener('click', async ()=>{
    const file = $('#csvFile').files[0];
    if(!file) return alert('Choose a CSV file');
    const text = await file.text();
    StorageAPI.importCSV(text);
    loadData();
  });
  $('#btnExportCSV').addEventListener('click', ()=>{
    const csv = StorageAPI.exportCSV();
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'store-angel-items.csv';
    a.click();
  });

  // ---------- Cashiers ----------
  cashierForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    if((state.user?.role||'')!=='admin'){ return alert('Only admin'); }
    const data = Object.fromEntries(new FormData(cashierForm).entries());
    StorageAPI.upsertUser({role:'cashier', ...data});
    cashierForm.reset();
    loadData();
  });

  function renderCashiers(users){
    cashiersTable.innerHTML = '';
    users.filter(u=>u.role==='cashier').forEach(u=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${u.name}</td><td>${u.username}</td><td>${u.online?'<span class="muted">online</span>':'—'}</td><td>${(u.hoursToday||0).toFixed(2)}</td><td>
        <button class="btn sm ghost remove"><i class="fa-solid fa-user-xmark"></i></button>
      </td>`;
      tr.querySelector('.remove').addEventListener('click', ()=>{
        if((state.user?.role||'')!=='admin'){ return alert('Only admin'); }
        if(confirm('Remove cashier?')){ StorageAPI.removeUser(u.username); loadData(); }
      });
      cashiersTable.appendChild(tr);
    });
  }

  // ---------- POS / Cart ----------
  function addToCart(key, qty){
    const item = StorageAPI.findItemByKey(key);
    if(!item){ alert('Item not found'); return; }
    const line = state.cart.find(l=>l.id===item.id);
    if(line){ line.qty += qty; }
    else { state.cart.push({ id:item.id, name:item.name, price:+item.price, qty:qty, sku:item.sku||''}); }
    renderCart();
  }

  function setQty(id, qty){
    const line = state.cart.find(l=>l.id===id); if(!line) return; line.qty = Math.max(0, qty|0); renderCart();
  }
  function removeLine(id){
    state.cart = state.cart.filter(l=>l.id!==id); renderCart();
  }
  function computeTotals(){
    const sub = state.cart.reduce((a,b)=>a + b.price*b.qty, 0);
    const disc = +discountEl.value||0;
    const total = Math.max(0, sub - disc);
    return {sub, disc, total};
  }
  function renderCart(){
    ticketLines.innerHTML = '';
    for(const l of state.cart){
      const row = document.createElement('div');
      row.className = 'line';
      row.innerHTML = `
        <div class="name">${l.name}</div>
        <div class="price">₦${l.price.toLocaleString()}</div>
        <div class="qty"><button class="btn sm ghost minus">−</button><input value="${l.qty}"/><button class="btn sm ghost plus">+</button></div>
        <div class="total">₦${(l.price*l.qty).toLocaleString()}</div>
        <button class="btn sm ghost del" title="Remove"><i class="fa-solid fa-xmark"></i></button>`;
      row.querySelector('.minus').addEventListener('click', ()=> setQty(l.id, l.qty-1));
      row.querySelector('.plus').addEventListener('click', ()=> setQty(l.id, l.qty+1));
      row.querySelector('input').addEventListener('change', (e)=> setQty(l.id, +e.target.value||0));
      row.querySelector('.del').addEventListener('click', ()=> removeLine(l.id));
      ticketLines.appendChild(row);
    }
    const {sub, total} = computeTotals();
    subTotalEl.textContent = sub.toLocaleString(undefined,{maximumFractionDigits:2});
    grandTotalEl.textContent = total.toLocaleString(undefined,{maximumFractionDigits:2});
    ticketTime.textContent = new Date().toLocaleString();
  }
  discountEl.addEventListener('change', renderCart);

  // Payment buttons
  $$('.btn.pay').forEach(b=> b.addEventListener('click', ()=>{
    state.paymentMode = b.dataset.mode;
    $$('.btn.pay').forEach(x=>x.classList.remove('primary'));
    b.classList.add('primary');
  }));

  $('#btnClear').addEventListener('click', ()=>{ state.cart = []; renderCart(); });
  $('#btnHold').addEventListener('click', ()=>{ StorageAPI.holdCart(state.cart); state.cart=[]; renderCart(); alert('Held!'); });
  $('#btnCheckout').addEventListener('click', ()=>{
    if(!state.user){ return alert('Login required'); }
    if(state.cart.length===0){ return alert('Cart empty'); }
    const {sub, disc, total} = computeTotals();
    const tx = StorageAPI.checkout({
      lines: state.cart.map(l=>({id:l.id,name:l.name,price:l.price,qty:l.qty,sku:l.sku})),
      totals: {sub, disc, total},
      cashier: state.user.name,
      mode: state.paymentMode,
    });
    state.cart = []; renderCart();
    printReceipt(tx);
    loadData();
  });

  function printReceipt(tx){
    const settings = StorageAPI.getSettings();
    const head = (settings.receiptHeader||'').replace(/\n/g,'<br>');
    const foot = (settings.receiptFooter||'').replace(/\n/g,'<br>');
    const lines = tx.lines.map(l=>`<tr><td>${l.qty} x ${l.name}</td><td>₦${(l.price*l.qty).toLocaleString()}</td></tr>`).join('');
    receipt.innerHTML = `
      <div style="text-align:center">${head}</div>
      <hr>
      <div>Date: ${new Date(tx.time).toLocaleString()}<br/>Cashier: ${tx.cashier}<br/>Mode: ${tx.mode.toUpperCase()}</div>
      <table style="width:100%">${lines}</table>
      <hr>
      <div>Subtotal: ₦${tx.totals.sub.toLocaleString()}<br/>Discount: ₦${tx.totals.disc.toLocaleString()}<br/><b>Total: ₦${tx.totals.total.toLocaleString()}</b></div>
      <hr>
      <div style="text-align:center">${foot}</div>
    `;
    window.print();
  }

  // ---------- Barcode / Search ----------
  // Many USB scanners type into focused input and send Enter
  scanInput.addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
      e.preventDefault();
      const q = scanInput.value.trim();
      if(!q) return;
      // Try barcode->add 1 qty, else search and show filtered catalog
      const item = StorageAPI.findItemByKey(q);
      if(item){ addToCart(q,1); scanInput.value=''; return; }
      filterCatalog(q);
    }
  });
  $('#btnAddQuick').addEventListener('click', ()=>{
    const q = scanInput.value.trim(); if(q){ addToCart(q,1); scanInput.value=''; }
  });

  function filterCatalog(q){
    const items = StorageAPI.listItems().filter(it=>
      (it.name||'').toLowerCase().includes(q.toLowerCase()) ||
      (it.sku||'').toLowerCase().includes(q.toLowerCase()) ||
      (it.color||'').toLowerCase().includes(q.toLowerCase())
    );
    renderCatalog(items);
  }

  // ---------- Settings ----------
  $('#btnSaveSettings').addEventListener('click', ()=>{
    StorageAPI.saveSettings({
      storeName: settingStoreName.value.trim() || 'Store Angel',
      receiptHeader: settingReceiptHeader.value,
      receiptFooter: settingReceiptFooter.value,
    });
    applySettings();
    alert('Saved');
  });

  function applySettings(){
    const s = StorageAPI.getSettings();
    storeNameEl.textContent = s.storeName || 'Store Angel';
    settingStoreName.value = s.storeName || '';
    settingReceiptHeader.value = s.receiptHeader || '';
    settingReceiptFooter.value = s.receiptFooter || '';
  }

  // ---------- Dashboard ----------
  function refreshDashboard(){
    const today = new Date(); today.setHours(0,0,0,0);
    const txs = StorageAPI.listTransactions();
    const todayTotal = txs.filter(t=> new Date(t.time)>=today).reduce((a,b)=>a+b.totals.total,0);
    statSalesToday.textContent = '₦'+todayTotal.toLocaleString();
    statStockCount.textContent = StorageAPI.listItems().length;
    statActiveCashiers.textContent = StorageAPI.activeCashiersCount();

    Charts.renderBestItems('bestItemsChart', StorageAPI.bestItems());

    // Sales table (range)
    const tbody = $('#salesTable tbody');
    tbody.innerHTML = '';
    for(const t of txs.slice(-100).reverse()){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${new Date(t.time).toLocaleString()}</td><td>${t.cashier}</td><td>${t.lines.length}</td><td>₦${t.totals.total.toLocaleString()}</td>`;
      tbody.appendChild(tr);
    }
  }
  $('#btnRange').addEventListener('click', ()=>{
    const f = $('#fromDate').valueAsDate; const to = $('#toDate').valueAsDate;
    const tbody = $('#salesTable tbody'); tbody.innerHTML='';
    const txs = StorageAPI.listTransactions().filter(t=>{
      const d = new Date(t.time);
      return (!f || d>=f) && (!to || d<=new Date(to.getFullYear(),to.getMonth(),to.getDate(),23,59,59));
    });
    for(const t of txs){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${new Date(t.time).toLocaleString()}</td><td>${t.cashier}</td><td>${t.lines.length}</td><td>₦${t.totals.total.toLocaleString()}</td>`;
      tbody.appendChild(tr);
    }
  });

  // ---------- Load Data ----------
  function loadData(){
    const items = StorageAPI.listItems();
    renderCatalog(items);
    renderItemsTable(items);
    renderCashiers(StorageAPI.listUsers());
    applySettings();
    refreshDashboard();
  }

  // Boot
  StorageAPI.init();
  // Seed default admin if none
  if(!StorageAPI.listUsers().some(u=>u.role==='admin')){
    StorageAPI.upsertUser({role:'admin', name:'Admin', username:'admin', password:'admin'});
  }
  loadData();
  refreshGuards();
})();
</script>


<!-- =============================
= 5) /storage.js
============================== -->
<script id="storage.js">
/* Simple Local DB + Cloud Sync Adapter + Offline Queue */
const StorageAPI = (()=>{
  const KEY = 'storeAngel.v1';
  let db = null;
  const now = ()=> Date.now();

  const blank = () => ({
    items: [],
    users: [],
    transactions: [],
    holds: [],
    settings: { storeName:'Store Angel', receiptHeader:'Store Angel\n123 Market Road, Lagos', receiptFooter:'Thanks for shopping!'},
    sessions: {}, // username -> {online:boolean,lastSeen:number,hoursToday:number}
    pending: [], // offline actions to sync
  });

  function save(){ localStorage.setItem(KEY, JSON.stringify(db)); }
  function load(){ db = JSON.parse(localStorage.getItem(KEY)||'null') || blank(); }

  // ------- Items -------
  function upsertItem(data){
    let it = null;
    if(data.id){ it = db.items.find(x=>x.id===data.id); }
    if(!it){
      // try by sku+name
      it = db.items.find(x=> (data.sku && x.sku===data.sku) || x.name===data.name);
    }
    if(it){ Object.assign(it, data); }
    else { db.items.push({ id:crypto.randomUUID(), ...data}); }
    save(); queue({type:'upsertItem', data});
  }
  function deleteItem(id){ db.items = db.items.filter(x=>x.id!==id); save(); queue({type:'deleteItem',id}); }
  function listItems(){ return [...db.items]; }
  function findItemByKey(key){ return db.items.find(x=> x.sku===key || x.id===key || (x.name||'').toLowerCase()===key.toLowerCase()); }

  // ------- Users / Cashiers -------
  function upsertUser(u){
    const ex = db.users.find(x=>x.username===u.username);
    if(ex){ Object.assign(ex, u); }
    else { db.users.push({ id:crypto.randomUUID(), ...u }); }
    save(); queue({type:'upsertUser', u});
  }
  function removeUser(username){ db.users = db.users.filter(u=>u.username!==username); save(); queue({type:'removeUser', username}); }
  function listUsers(){ return [...db.users]; }

  let current = null;
  function login(role, username, password){
    const u = db.users.find(x=>x.username===username && x.password===password && x.role===role);
    if(!u) return false; current = u; markOnline(u.username,true); save(); return true;
  }
  function logout(){ if(current){ markOnline(current.username,false); current=null; save(); } }
  function currentUser(){ return current; }

  function markOnline(username, online){
    const s = db.sessions[username] || {online:false,lastSeen:0,hoursToday:0,start:0};
    if(online && !s.online){ s.start = now(); }
    if(!online && s.online){ s.hoursToday += (now()-s.start)/3600000; s.start=0; }
    s.online = online; s.lastSeen = now(); db.sessions[username]=s; save();
  }
  function activeCashiersCount(){ return Object.values(db.sessions).filter(s=>s.online).length; }

  // ------- POS / Transactions -------
  function checkout(payload){
    // decrement stock
    for(const l of payload.lines){
      const it = db.items.find(x=>x.id===l.id);
      if(it){ it.quantity = Math.max(0, (+it.quantity||0) - l.qty); }
    }
    const tx = { id:crypto.randomUUID(), time:now(), ...payload };
    db.transactions.push(tx); save(); queue({type:'checkout', tx});
    return tx;
  }
  function listTransactions(){ return [...db.transactions]; }
  function holdCart(lines){ db.holds.push({id:crypto.randomUUID(),time:now(),lines}); save(); }

  // ------- Settings -------
  function saveSettings(s){ db.settings = {...db.settings, ...s}; save(); queue({type:'saveSettings', s}); }
  function getSettings(){ return {...db.settings}; }

  // ------- CSV -------
  function exportCSV(){
    const hdr = ['sku','name','unit','weight','color','price','quantity'];
    const rows = db.items.map(i=> hdr.map(h=> (i[h]??'')).join(','));
    return [hdr.join(','), ...rows].join('\n');
  }
  function importCSV(text){
    const [head, ...lines] = text.split(/\r?\n/).filter(Boolean);
    const cols = head.split(',');
    for(const ln of lines){
      const vals = ln.split(',');
      const o = {}; cols.forEach((c,i)=> o[c]=vals[i]);
      o.price = +o.price||0; o.quantity = +o.quantity||0;
      upsertItem(o);
    }
  }

  // ------- Analytics helpers -------
  function bestItems(){
    const tally = new Map();
    for(const t of db.transactions){
      for(const l of t.lines){ tally.set(l.name, (tally.get(l.name)||0)+l.qty); }
    }
    return Array.from(tally.entries()).sort((a,b)=>b[1]-a[1]).slice(0,10).map(([name,qty])=>({name,qty}));
  }

  // ------- Cloud Sync (Stub) -------
  // Replace BASE_URL with your API or use the bundled server.js (Socket.IO)
  const BASE_URL = '';// e.g., 'https://your-api.example.com'
  async function pushPending(){
    if(!BASE_URL){ return; } // no-op until configured
    const queue = [...db.pending];
    for(const job of queue){
      try{
        await fetch(BASE_URL+'/sync', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(job)});
        db.pending = db.pending.filter(j=>j!==job); save();
      }catch(e){ /* keep for later */ }
    }
  }
  function queue(job){ db.pending.push(job); save(); pushPending(); }

  function init(){ load(); setInterval(pushPending, 5000); }

  return { init, upsertItem, deleteItem, listItems, findItemByKey,
    upsertUser, removeUser, listUsers, login, logout, currentUser,
    listTransactions, checkout, holdCart,
    saveSettings, getSettings, exportCSV, importCSV,
    activeCashiersCount, bestItems };
})();
</script>


<!-- =============================
= 6) /charts.js
============================== -->
<script id="charts.js">
const Charts = (()=>{
  function renderBestItems(canvasId, data){
    const ctx = document.getElementById(canvasId);
    if(!ctx) return;
    if(ctx._chart){ ctx._chart.destroy(); }
    ctx._chart = new Chart(ctx, {
      type: 'pie',
      data: { labels: data.map(d=>d.name), datasets: [{ data: data.map(d=>d.qty) }]},
      options: { plugins:{ legend:{position:'bottom'} } }
    });
  }
  return { renderBestItems };
})();
</script>


<!-- =============================
= 7) /server.js (optional for live multi‑PC)
============================== -->
<script id="server.js">
/*
Optional Node server for cloud + live sync. Save this section as server.js
and run:  npm i express socket.io cors  &&  node server.js
Then set BASE_URL in storage.js to your server URL.
*/
/*
const express = require('express');
const http = require('http');
const { Server } = require('socket.io');
const cors = require('cors');

const app = express();
const server = http.createServer(app);
const io = new Server(server, { cors:{origin:'*'} });

app.use(cors());
app.use(express.json());

// In‑memory (swap to a DB like Mongo or Postgres for production)
let snapshot = { items:[], users:[], transactions:[], settings:{} };

app.post('/sync', (req,res)=>{
  const job = req.body; io.emit('sync', job); // broadcast
  // naive apply
  switch(job.type){
    case 'upsertItem':{
      const i = snapshot.items.findIndex(x=>x.id===job.data.id || x.sku===job.data.sku);
      if(i>=0) snapshot.items[i] = {...snapshot.items[i], ...job.data}; else snapshot.items.push(job.data); break; }
    case 'deleteItem': snapshot.items = snapshot.items.filter(x=>x.id!==job.id); break;
    case 'upsertUser':{
      const i = snapshot.users.findIndex(x=>x.username===job.u.username);
      if(i>=0) snapshot.users[i] = {...snapshot.users[i], ...job.u}; else snapshot.users.push(job.u); break; }
    case 'removeUser': snapshot.users = snapshot.users.filter(u=>u.username!==job.username); break;
    case 'checkout': snapshot.transactions.push(job.tx); break;
    case 'saveSettings': snapshot.settings = {...snapshot.settings, ...job.s}; break;
  }
  res.json({ok:true});
});

io.on('connection', (socket)=>{
  console.log('client connected');
});

const PORT = process.env.PORT || 8080;
server.listen(PORT, ()=> console.log('Server on http://localhost:'+PORT));
*/
</script>


<!-- =============================
= 8) /README.md
============================== -->
<script id="README.md" type="text/plain">
# Store Angel (Vanilla JS)

A mobile‑friendly stock & POS system with:
- Admin & Cashier roles (frontend guards)
- Inventory with units (pcs/pack/roll), weight, color, price, qty
- Barcode scanning via keyboard‑wedge scanners
- POS with multi‑item cart, discounts, payment modes (cash/POS/transfer/mixed)
- Printable receipts with cashier name & customizable header/footer
- CSV import/export
- LocalStorage persistence + Cloud sync adapter + optional Socket.IO server for multi‑PC live updates
- Dashboard with best performing items pie chart and sales table

## Quick Start
1. Save each section as separate files:
   - `index.html`, `styles.css`, `printer.css`, `app.js`, `storage.js`, `charts.js`.
2. Open `index.html` in your browser.
3. Default admin: **admin / admin**.
4. Change Settings → Store Name & receipt header/footer.

## Barcode
- Click the search box and scan. Most USB scanners type the code and press **Enter**. If a SKU matches, it adds 1 to cart; otherwise it filters catalog.

## CSV Format
Columns: `sku,name,unit,weight,color,price,quantity`

## Cloud Sync / Multi‑PC (Optional)
- Use the included `server.js` to broadcast updates via Socket.IO. Deploy on a VPS or LAN.
- Set `BASE_URL` in `storage.js`. All mutations are queued offline and POSTed to `/sync` when online.

## Notes
- This is a frontend‑only app; server is optional for live sync.
- For production, secure auth & move data to a real backend (JWT + DB). Frontend guards are UX only.
</script>
